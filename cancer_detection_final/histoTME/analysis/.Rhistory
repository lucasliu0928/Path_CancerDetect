label_dir2 <- paste0(proj_dir, "3C_labels_train_test/", "TCGA_PRAD", "/TFT0.9/")
label_dir3 <- paste0(proj_dir, "3C_labels_train_test/", "Neptune", "/TFT0.9/")
tme_dir   <- paste0(proj_dir, "0_HistoTME/TME/TF0.9/")
# ------------------ Load ------------------
tmd_df_opx   <- read.csv(paste0(tme_dir, "OPX", "_predictions_uni2.csv"), check.names = FALSE)
colnames(tmd_df_opx)[1] <- "SAMPLE_ID"
label_df_opx <- read.csv(paste0(label_dir, "train_test_split.csv"), check.names = FALSE)
comb_df_opx <- merge(tmd_df_opx, label_df_opx, by = "SAMPLE_ID")
tmd_df_tcga   <- read.csv(paste0(tme_dir, "TCGA_PRAD", "_predictions_uni2.csv"), check.names = FALSE)
colnames(tmd_df_tcga)[1] <- "SAMPLE_ID"
label_df_tcga <- read.csv(paste0(label_dir2, "train_test_split.csv"), check.names = FALSE)
comb_df_tcga <- merge(tmd_df_tcga, label_df_tcga, by = "SAMPLE_ID")
tmd_df_nep  <- read.csv(paste0(tme_dir, "Neptune", "_predictions_uni2.csv"), check.names = FALSE)
colnames(tmd_df_nep)[1] <- "SAMPLE_ID"
label_df_nep <- read.csv(paste0(label_dir3, "train_test_split.csv"), check.names = FALSE)
comb_df_nep <- merge(tmd_df_nep, label_df_nep, by = "SAMPLE_ID")
comb_df <- do.call(rbind,list(comb_df_opx,comb_df_tcga,comb_df_nep))
View(comb_df)
source("~/Desktop/TME.R", echo=TRUE)
table(comb_df$MSI_POS)
source("~/Desktop/TME.R", echo=TRUE)
setwd("~/Desktop")
setwd("~/Desktop")
library(ggplot2)
library(dplyr)
df <- read.csv("/Volumes/Lucas/mh_proj/mutation_pred/intermediate_data/0_HistoTME/TME_Spatial/TF0.0/uni2/OPX_007_5fold.csv")
df <- df[,-1]
tile_info_df <- read.csv("/Volumes/Lucas/mh_proj/mutation_pred/intermediate_data/2_cancer_detection/OPX/IMSIZE250_OL0/OPX_007/ft_model/OPX_007_TILE_TUMOR_PERC.csv")
tile_info_df <- tile_info_df %>%
mutate(TILE_XY_INDEXES = gsub("[()]", "", TILE_XY_INDEXES)) %>%  # remove parentheses
separate(TILE_XY_INDEXES, into = c("x", "y"), sep = ", ") %>%   # split by comma + space
mutate(across(c(y, y), as.integer))                             # convert to integers
df <- read.csv("/Volumes/Lucas/mh_proj/mutation_pred/intermediate_data/0_HistoTME/TME_Spatial/TF0.0/uni2/OPX_007_5fold.csv")
df <- df[,-1]
tile_info_df <- read.csv("/Volumes/Lucas/mh_proj/mutation_pred/intermediate_data/2_cancer_detection/OPX/IMSIZE250_OL0/OPX_007/ft_model/OPX_007_TILE_TUMOR_PERC.csv")
tile_info_df <- tile_info_df %>%
mutate(TILE_XY_INDEXES = gsub("[()]", "", TILE_XY_INDEXES)) %>%  # remove parentheses
separate(TILE_XY_INDEXES, into = c("x", "y"), sep = ", ") %>%   # split by comma + space
mutate(across(c(y, y), as.integer))                             # convert to integers
library(dplyr)
df <- read.csv("/Volumes/Lucas/mh_proj/mutation_pred/intermediate_data/0_HistoTME/TME_Spatial/TF0.0/uni2/OPX_007_5fold.csv")
df <- df[,-1]
tile_info_df <- read.csv("/Volumes/Lucas/mh_proj/mutation_pred/intermediate_data/2_cancer_detection/OPX/IMSIZE250_OL0/OPX_007/ft_model/OPX_007_TILE_TUMOR_PERC.csv")
tile_info_df <- tile_info_df %>%
mutate(TILE_XY_INDEXES = gsub("[()]", "", TILE_XY_INDEXES)) %>%  # remove parentheses
separate(TILE_XY_INDEXES, into = c("x", "y"), sep = ", ") %>%   # split by comma + space
mutate(across(c(y, y), as.integer))                             # convert to integers
library(tidyr)
df <- read.csv("/Volumes/Lucas/mh_proj/mutation_pred/intermediate_data/0_HistoTME/TME_Spatial/TF0.0/uni2/OPX_007_5fold.csv")
df <- df[,-1]
tile_info_df <- read.csv("/Volumes/Lucas/mh_proj/mutation_pred/intermediate_data/2_cancer_detection/OPX/IMSIZE250_OL0/OPX_007/ft_model/OPX_007_TILE_TUMOR_PERC.csv")
tile_info_df <- tile_info_df %>%
mutate(TILE_XY_INDEXES = gsub("[()]", "", TILE_XY_INDEXES)) %>%  # remove parentheses
separate(TILE_XY_INDEXES, into = c("x", "y"), sep = ", ") %>%   # split by comma + space
mutate(across(c(y, y), as.integer))                             # convert to integers
comb_df <- merge(df, tile_info_df, by = c('x','y'), all.y=TRUE)
View(comb_df)
View(comb_df)
# If duplicates exist, average them
df_avg <- comb_df %>%
group_by(pred_map_location) %>%
summarise(Checkpoint_inhibition = mean(Checkpoint_inhibition), .groups = "drop")
dv_acg
df_avg
View(df_avg)
# Extract numbers
df_clean <- df_avg %>%
mutate(pred_map_location = gsub("[()]", "", pred_map_location)) %>%  # remove parentheses
separate(pred_map_location, into = c("x_start", "x_end", "y_start", "y_end"), sep = ", ") %>%
mutate(across(c(x_start, x_end, y_start, y_end), as.numeric))
# Plot rectangles colored by T_cells
ggplot(df_clean) +
geom_rect(
aes(xmin = y_start, xmax = y_end, ymin = x_start, ymax = x_end, fill = T_cells),
color = NA
) +
scale_fill_gradient2(
low = "blue", mid = "white", high = "red", midpoint = 0,
na.value = "gray"   # NA values shown as gray
) +
coord_fixed() +
scale_y_reverse() +  # optional, for image-like coords
theme_minimal() +
labs(
title = "Heatmap of T_cells",
x = "X", y = "Y", fill = "T_cells"
)
# Plot rectangles colored by Checkpoint_inhibition
ggplot(df_clean) +
geom_rect(
aes(xmin = y_start, xmax = y_end, ymin = x_start, ymax = x_end, fill = Checkpoint_inhibition),
color = NA
) +
scale_fill_gradient2(
low = "blue", mid = "white", high = "red", midpoint = 0,
na.value = "gray"   # NA values shown as gray
) +
coord_fixed() +
scale_y_reverse() +  # optional, for image-like coords
theme_minimal() +
labs(
title = "Heatmap of Checkpoint_inhibition",
x = "X", y = "Y", fill = "Checkpoint_inhibition"
)
View(tile_info_df)
df <- read.csv("/Volumes/Lucas/mh_proj/mutation_pred/intermediate_data/0_HistoTME/TME_Spatial/TF0.9/uni2/OPX_007_5fold.csv")
df <- df[,-1]
tile_info_df <- read.csv("/Volumes/Lucas/mh_proj/mutation_pred/intermediate_data/2_cancer_detection/OPX/IMSIZE250_OL0/OPX_007/ft_model/OPX_007_TILE_TUMOR_PERC.csv")
#Tumor fraction
tile_info_df <- tile_info_df %>%
mutate(TILE_XY_INDEXES = gsub("[()]", "", TILE_XY_INDEXES)) %>%  # remove parentheses
separate(TILE_XY_INDEXES, into = c("x", "y"), sep = ", ") %>%   # split by comma + space
mutate(across(c(y, y), as.integer))                             # convert to integers
comb_df <- merge(df, tile_info_df, by = c('x','y'), all.y=TRUE)
# If duplicates exist, average them
df_avg <- comb_df %>%
group_by(pred_map_location) %>%
summarise(Checkpoint_inhibition = mean(Checkpoint_inhibition), .groups = "drop")
# Extract numbers
df_clean <- df_avg %>%
mutate(pred_map_location = gsub("[()]", "", pred_map_location)) %>%  # remove parentheses
separate(pred_map_location, into = c("x_start", "x_end", "y_start", "y_end"), sep = ", ") %>%
mutate(across(c(x_start, x_end, y_start, y_end), as.numeric))
# # Plot heatmap
# ggplot(df_avg, aes(x = x, y = y, fill = T_cells)) +
#   geom_tile() +
#   scale_fill_gradient2(low = "blue", mid = "white", high = "red", midpoint = 0) +
#   theme_minimal() +
#   labs(title = "Heatmap of T_cells",
#        x = "x",
#        y = "y",
#        fill = "T_cells")
# Plot rectangles colored by Checkpoint_inhibition
ggplot(df_clean) +
geom_rect(
aes(xmin = y_start, xmax = y_end, ymin = x_start, ymax = x_end, fill = Checkpoint_inhibition),
color = NA
) +
scale_fill_gradient2(
low = "blue", mid = "white", high = "red", midpoint = 0,
na.value = "gray"   # NA values shown as gray
) +
coord_fixed() +
scale_y_reverse() +  # optional, for image-like coords
theme_minimal() +
labs(
title = "Heatmap of Checkpoint_inhibition",
x = "X", y = "Y", fill = "Checkpoint_inhibition"
)
sample_id <- "OPX_075"
df <- read.csv(paste0("/Volumes/Lucas/mh_proj/mutation_pred/intermediate_data/0_HistoTME/TME_Spatial/TF0.9/uni2/" + sample_id + "_5fold.csv"))
sample_id <- "OPX_075"
df <- read.csv(paste0("/Volumes/Lucas/mh_proj/mutation_pred/intermediate_data/0_HistoTME/TME_Spatial/TF0.9/uni2/", sample_id, "_5fold.csv"))
df <- read.csv(paste0("/Volumes/Lucas/mh_proj/mutation_pred/intermediate_data/0_HistoTME/TME_Spatial/TF0.9/uni2/", sample_id, "_5fold.csv"))
library(ggplot2)
library(dplyr)
library(tidyr)
proj_dir <- "/Volumes/Lucas/mh_proj/mutation_pred/intermediate_data/"
histo_data_dir <- paste0(proj_dir, "0_HistoTME/TME_Spatial/TF0.9/uni2/")
cancer_data_dir <- paste0(proj_dir, "2_cancer_detection/OPX/IMSIZE250_OL0/")
sample_id <- "OPX_075"
df <- read.csv(paste0(histo_data_dir, sample_id, "_5fold.csv"))
df <- df[,-1]
tile_info_df <- read.csv(paste0(cancer_data_dir, sample_id, "/ft_model/", sample_id, "_TILE_TUMOR_PERC.csv"))
#read
df <- read.csv(paste0(histo_data_dir, sample_id, "_5fold.csv"))
df <- df[,-1]
tile_info_df <- read.csv(paste0(cancer_data_dir, sample_id, "/ft_model/", sample_id, "_TILE_TUMOR_PERC.csv"))
tile_info_df <- tile_info_df %>%
mutate(TILE_XY_INDEXES = gsub("[()]", "", TILE_XY_INDEXES)) %>%  # remove parentheses
separate(TILE_XY_INDEXES, into = c("x", "y"), sep = ", ") %>%   # split by comma + space
mutate(across(c(y, y), as.integer))                             # convert to integers
comb_df <- merge(df, tile_info_df, by = c('x','y'), all.y=TRUE)
# If duplicates exist, average them
df_avg <- comb_df %>%
group_by(pred_map_location) %>%
summarise(Checkpoint_inhibition = mean(Checkpoint_inhibition), .groups = "drop")
# Extract numbers
df_clean <- df_avg %>%
mutate(pred_map_location = gsub("[()]", "", pred_map_location)) %>%  # remove parentheses
separate(pred_map_location, into = c("x_start", "x_end", "y_start", "y_end"), sep = ", ") %>%
mutate(across(c(x_start, x_end, y_start, y_end), as.numeric))
# # Plot heatmap
# ggplot(df_avg, aes(x = x, y = y, fill = T_cells)) +
#   geom_tile() +
#   scale_fill_gradient2(low = "blue", mid = "white", high = "red", midpoint = 0) +
#   theme_minimal() +
#   labs(title = "Heatmap of T_cells",
#        x = "x",
#        y = "y",
#        fill = "T_cells")
# Plot rectangles colored by Checkpoint_inhibition
ggplot(df_clean) +
geom_rect(
aes(xmin = y_start, xmax = y_end, ymin = x_start, ymax = x_end, fill = Checkpoint_inhibition),
color = NA
) +
scale_fill_gradient2(
low = "blue", mid = "white", high = "red", midpoint = 0,
na.value = "gray"   # NA values shown as gray
) +
coord_fixed() +
scale_y_reverse() +  # optional, for image-like coords
theme_minimal() +
labs(
title = "Heatmap of Checkpoint_inhibition",
x = "X", y = "Y", fill = "Checkpoint_inhibition"
)
source("~/Desktop/tme_spatial.R")
ggplot(df_clean) +
geom_rect(
aes(xmin = y_start, xmax = y_end, ymin = x_start, ymax = x_end, fill = Checkpoint_inhibition),
color = NA
) +
scale_fill_gradient2(
low = "blue", mid = "white", high = "red", midpoint = 0,
na.value = "gray"   # NA values shown as gray
) +
coord_fixed() +
scale_y_reverse() +  # optional, for image-like coords
theme_minimal() +
labs(
title = "Heatmap of Checkpoint_inhibition",
x = "X", y = "Y", fill = "Checkpoint_inhibition"
)
library(ggplot2)
library(dplyr)
library(tidyr)
proj_dir <- "/Volumes/Lucas/mh_proj/mutation_pred/intermediate_data/"
histo_data_dir <- paste0(proj_dir, "0_HistoTME/TME_Spatial/TF0.0/uni2/")
cancer_data_dir <- paste0(proj_dir, "2_cancer_detection/OPX/IMSIZE250_OL0/")
sample_id <- "OPX_075"
#read
df <- read.csv(paste0(histo_data_dir, sample_id, "_5fold.csv"))
df <- df[,-1]
tile_info_df <- read.csv(paste0(cancer_data_dir, sample_id, "/ft_model/", sample_id, "_TILE_TUMOR_PERC.csv"))
tile_info_df <- tile_info_df %>%
mutate(TILE_XY_INDEXES = gsub("[()]", "", TILE_XY_INDEXES)) %>%  # remove parentheses
separate(TILE_XY_INDEXES, into = c("x", "y"), sep = ", ") %>%   # split by comma + space
mutate(across(c(y, y), as.integer))                             # convert to integers
comb_df <- merge(df, tile_info_df, by = c('x','y'), all.y=TRUE)
# If duplicates exist, average them
df_avg <- comb_df %>%
group_by(pred_map_location) %>%
summarise(Checkpoint_inhibition = mean(Checkpoint_inhibition), .groups = "drop")
# Extract numbers
df_clean <- df_avg %>%
mutate(pred_map_location = gsub("[()]", "", pred_map_location)) %>%  # remove parentheses
separate(pred_map_location, into = c("x_start", "x_end", "y_start", "y_end"), sep = ", ") %>%
mutate(across(c(x_start, x_end, y_start, y_end), as.numeric))
# # Plot heatmap
# ggplot(df_avg, aes(x = x, y = y, fill = T_cells)) +
#   geom_tile() +
#   scale_fill_gradient2(low = "blue", mid = "white", high = "red", midpoint = 0) +
#   theme_minimal() +
#   labs(title = "Heatmap of T_cells",
#        x = "x",
#        y = "y",
#        fill = "T_cells")
# Plot rectangles colored by Checkpoint_inhibition
ggplot(df_clean) +
geom_rect(
aes(xmin = y_start, xmax = y_end, ymin = x_start, ymax = x_end, fill = Checkpoint_inhibition),
color = NA
) +
scale_fill_gradient2(
low = "blue", mid = "white", high = "red", midpoint = 0,
na.value = "gray"   # NA values shown as gray
) +
coord_fixed() +
scale_y_reverse() +  # optional, for image-like coords
theme_minimal() +
labs(
title = "Heatmap of Checkpoint_inhibition",
x = "X", y = "Y", fill = "Checkpoint_inhibition"
)
library(ggplot2)
library(dplyr)
library(tidyr)
proj_dir <- "/Volumes/Lucas/mh_proj/mutation_pred/intermediate_data/"
histo_data_dir <- paste0(proj_dir, "0_HistoTME/TME_Spatial/TF0.0/uni2/")
cancer_data_dir <- paste0(proj_dir, "2_cancer_detection/OPX/IMSIZE250_OL0/")
sample_id <- "OPX_075"
#read
df <- read.csv(paste0(histo_data_dir, sample_id, "_5fold.csv"))
df <- df[,-1]
tile_info_df <- read.csv(paste0(cancer_data_dir, sample_id, "/ft_model/", sample_id, "_TILE_TUMOR_PERC.csv"))
tile_info_df <- tile_info_df %>%
mutate(TILE_XY_INDEXES = gsub("[()]", "", TILE_XY_INDEXES)) %>%  # remove parentheses
separate(TILE_XY_INDEXES, into = c("x", "y"), sep = ", ") %>%   # split by comma + space
mutate(across(c(y, y), as.integer))                             # convert to integers
comb_df <- merge(df, tile_info_df, by = c('x','y'), all.y=TRUE)
# If duplicates exist, average them
df_avg <- comb_df %>%
group_by(pred_map_location) %>%
summarise(Checkpoint_inhibition = mean(Checkpoint_inhibition), .groups = "drop")
# Extract numbers
df_clean <- df_avg %>%
mutate(pred_map_location = gsub("[()]", "", pred_map_location)) %>%  # remove parentheses
separate(pred_map_location, into = c("x_start", "x_end", "y_start", "y_end"), sep = ", ") %>%
mutate(across(c(x_start, x_end, y_start, y_end), as.numeric))
# # Plot heatmap
# ggplot(df_avg, aes(x = x, y = y, fill = T_cells)) +
#   geom_tile() +
#   scale_fill_gradient2(low = "blue", mid = "white", high = "red", midpoint = 0) +
#   theme_minimal() +
#   labs(title = "Heatmap of T_cells",
#        x = "x",
#        y = "y",
#        fill = "T_cells")
# Plot rectangles colored by Checkpoint_inhibition
ggplot(df_clean) +
geom_rect(
aes(xmin = y_start, xmax = y_end, ymin = x_start, ymax = x_end, fill = Checkpoint_inhibition),
color = NA
) +
scale_fill_gradient2(
low = "blue", mid = "white", high = "red", midpoint = 0,
na.value = "gray"   # NA values shown as gray
) +
coord_fixed() +
scale_y_reverse() +  # optional, for image-like coords
theme_minimal() +
labs(
title = "Heatmap of Checkpoint_inhibition",
x = "X", y = "Y", fill = "Checkpoint_inhibition"
)
proj_dir <- "/Volumes/Lucas/mh_proj/mutation_pred/intermediate_data/"
histo_data_dir <- paste0(proj_dir, "0_HistoTME/TME_Spatial/TF0.0/uni2/")
cancer_data_dir <- paste0(proj_dir, "2_cancer_detection/OPX/IMSIZE250_OL0/")
sample_id <- "OPX_075"
#read
df <- read.csv(paste0(histo_data_dir, sample_id, "_5fold.csv"))
df <- df[,-1]
tile_info_df <- read.csv(paste0(cancer_data_dir, sample_id, "/ft_model/", sample_id, "_TILE_TUMOR_PERC.csv"))
tile_info_df <- tile_info_df %>%
mutate(TILE_XY_INDEXES = gsub("[()]", "", TILE_XY_INDEXES)) %>%  # remove parentheses
separate(TILE_XY_INDEXES, into = c("x", "y"), sep = ", ") %>%   # split by comma + space
mutate(across(c(y, y), as.integer))                             # convert to integers
comb_df <- merge(df, tile_info_df, by = c('x','y'), all.y=TRUE)
# If duplicates exist, average them
df_avg <- comb_df %>%
group_by(pred_map_location) %>%
summarise(T_cells = mean(T_cells), .groups = "drop")
# Extract numbers
df_clean <- df_avg %>%
mutate(pred_map_location = gsub("[()]", "", pred_map_location)) %>%  # remove parentheses
separate(pred_map_location, into = c("x_start", "x_end", "y_start", "y_end"), sep = ", ") %>%
mutate(across(c(x_start, x_end, y_start, y_end), as.numeric))
# # Plot heatmap
# ggplot(df_avg, aes(x = x, y = y, fill = T_cells)) +
#   geom_tile() +
#   scale_fill_gradient2(low = "blue", mid = "white", high = "red", midpoint = 0) +
#   theme_minimal() +
#   labs(title = "Heatmap of T_cells",
#        x = "x",
#        y = "y",
#        fill = "T_cells")
# Plot rectangles colored by T_cells
ggplot(df_clean) +
geom_rect(
aes(xmin = y_start, xmax = y_end, ymin = x_start, ymax = x_end, fill = T_cells),
color = NA
) +
scale_fill_gradient2(
low = "blue", mid = "white", high = "red", midpoint = 0,
na.value = "gray"   # NA values shown as gray
) +
coord_fixed() +
scale_y_reverse() +  # optional, for image-like coords
theme_minimal() +
labs(
title = "Heatmap of T_cells",
x = "X", y = "Y", fill = "T_cells"
)
library(ggplot2)
library(dplyr)
library(tidyr)
proj_dir <- "/Volumes/Lucas/mh_proj/mutation_pred/intermediate_data/"
histo_data_dir <- paste0(proj_dir, "0_HistoTME/TME_Spatial/TF0.9/uni2/")
cancer_data_dir <- paste0(proj_dir, "2_cancer_detection/OPX/IMSIZE250_OL0/")
sample_id <- "OPX_075"
#read
df <- read.csv(paste0(histo_data_dir, sample_id, "_5fold.csv"))
df <- df[,-1]
tile_info_df <- read.csv(paste0(cancer_data_dir, sample_id, "/ft_model/", sample_id, "_TILE_TUMOR_PERC.csv"))
tile_info_df <- tile_info_df %>%
mutate(TILE_XY_INDEXES = gsub("[()]", "", TILE_XY_INDEXES)) %>%  # remove parentheses
separate(TILE_XY_INDEXES, into = c("x", "y"), sep = ", ") %>%   # split by comma + space
mutate(across(c(y, y), as.integer))                             # convert to integers
comb_df <- merge(df, tile_info_df, by = c('x','y'), all.y=TRUE)
# If duplicates exist, average them
df_avg <- comb_df %>%
group_by(pred_map_location) %>%
summarise(T_cells = mean(T_cells), .groups = "drop")
# Extract numbers
df_clean <- df_avg %>%
mutate(pred_map_location = gsub("[()]", "", pred_map_location)) %>%  # remove parentheses
separate(pred_map_location, into = c("x_start", "x_end", "y_start", "y_end"), sep = ", ") %>%
mutate(across(c(x_start, x_end, y_start, y_end), as.numeric))
# # Plot heatmap
# ggplot(df_avg, aes(x = x, y = y, fill = T_cells)) +
#   geom_tile() +
#   scale_fill_gradient2(low = "blue", mid = "white", high = "red", midpoint = 0) +
#   theme_minimal() +
#   labs(title = "Heatmap of T_cells",
#        x = "x",
#        y = "y",
#        fill = "T_cells")
# Plot rectangles colored by T_cells
ggplot(df_clean) +
geom_rect(
aes(xmin = y_start, xmax = y_end, ymin = x_start, ymax = x_end, fill = T_cells),
color = NA
) +
scale_fill_gradient2(
low = "blue", mid = "white", high = "red", midpoint = 0,
na.value = "gray"   # NA values shown as gray
) +
coord_fixed() +
scale_y_reverse() +  # optional, for image-like coords
theme_minimal() +
labs(
title = "Heatmap of T_cells",
x = "X", y = "Y", fill = "T_cells"
)
library(ggplot2)
library(dplyr)
library(tidyr)
proj_dir <- "/Volumes/Lucas/mh_proj/mutation_pred/intermediate_data/"
histo_data_dir <- paste0(proj_dir, "0_HistoTME/TME_Spatial/TF0.9/uni2/")
cancer_data_dir <- paste0(proj_dir, "2_cancer_detection/OPX/IMSIZE250_OL0/")
sample_id <- "OPX_075"
#read
df <- read.csv(paste0(histo_data_dir, sample_id, "_5fold.csv"))
View(df)
df <- df[,-1]
tile_info_df <- read.csv(paste0(cancer_data_dir, sample_id, "/ft_model/", sample_id, "_TILE_TUMOR_PERC.csv"))
tile_info_df <- tile_info_df %>%
mutate(TILE_XY_INDEXES = gsub("[()]", "", TILE_XY_INDEXES)) %>%  # remove parentheses
separate(TILE_XY_INDEXES, into = c("x", "y"), sep = ", ") %>%   # split by comma + space
mutate(across(c(y, y), as.integer))                             # convert to integers
source("~/Desktop/tme_spatial.R")
source("~/Desktop/tme_spatial.R")
source("~/Desktop/tme_spatial.R")
# Plot rectangles colored by T_cells
ggplot(df_clean) +
geom_rect(
aes(xmin = y_start, xmax = y_end, ymin = x_start, ymax = x_end, fill = T_cells),
color = NA
) +
scale_fill_gradient2(
low = "blue", mid = "white", high = "red", midpoint = 0,
na.value = "gray"   # NA values shown as gray
) +
coord_fixed() +
scale_y_reverse() +  # optional, for image-like coords
theme_minimal() +
labs(
title = "Heatmap of T_cells",
x = "X", y = "Y", fill = "T_cells"
)
df$Checkpoint_inhibition
source("~/Desktop/tme_spatial.R")
# Plot rectangles colored by Checkpoint_inhibition
ggplot(df_clean) +
geom_rect(
aes(xmin = y_start, xmax = y_end, ymin = x_start, ymax = x_end, fill = Checkpoint_inhibition),
color = NA
) +
scale_fill_gradient2(
low = "blue", mid = "white", high = "red", midpoint = 0,
na.value = "gray"   # NA values shown as gray
) +
coord_fixed() +
scale_y_reverse() +  # optional, for image-like coords
theme_minimal() +
labs(
title = "Heatmap of Checkpoint_inhibition",
x = "X", y = "Y", fill = "Checkpoint_inhibition"
)
library(ggplot2)
library(dplyr)
library(tidyr)
proj_dir <- "/Volumes/Lucas/mh_proj/mutation_pred/intermediate_data/"
histo_data_dir <- paste0(proj_dir, "0_HistoTME/TME_Spatial/TF0.9/uni2/")
cancer_data_dir <- paste0(proj_dir, "2_cancer_detection/OPX/IMSIZE250_OL0/")
sample_id <- "OPX_075"
#read
df <- read.csv(paste0(histo_data_dir, sample_id, "_5fold.csv"))
df <- df[,-1]
tile_info_df <- read.csv(paste0(cancer_data_dir, sample_id, "/ft_model/", sample_id, "_TILE_TUMOR_PERC.csv"))
tile_info_df <- tile_info_df %>%
mutate(TILE_XY_INDEXES = gsub("[()]", "", TILE_XY_INDEXES)) %>%  # remove parentheses
separate(TILE_XY_INDEXES, into = c("x", "y"), sep = ", ") %>%   # split by comma + space
mutate(across(c(y, y), as.integer))
setwd("/Volumes/Lucas/mh_proj/mutation_pred/code_s/cancer_detection_final/histoTME/analysis")
library(ggplot2)
library(dplyr)
library(tidyr)
proj_dir <- "/Volumes/Lucas/mh_proj/mutation_pred/intermediate_data/"
histo_data_dir <- paste0(proj_dir, "0_HistoTME/TME_Spatial/TF0.9/uni2/")
cancer_data_dir <- paste0(proj_dir, "2_cancer_detection/OPX/IMSIZE250_OL0/")
sample_id <- "OPX_075"
#read
df <- read.csv(paste0(histo_data_dir, sample_id, "_5fold.csv"))
df <- df[,-1]
tile_info_df <- read.csv(paste0(cancer_data_dir, sample_id, "/ft_model/", sample_id, "_TILE_TUMOR_PERC.csv"))
tile_info_df <- tile_info_df %>%
mutate(TILE_XY_INDEXES = gsub("[()]", "", TILE_XY_INDEXES)) %>%  # remove parentheses
separate(TILE_XY_INDEXES, into = c("x", "y"), sep = ", ") %>%   # split by comma + space
mutate(across(c(y, y), as.integer))
